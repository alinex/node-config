<!DOCTYPE html>
<html>
<head>
  <title>index.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "home/alex/github/node-config/src/index.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#configuration">Configuration</a>
      </div>

      <div class="heading h2">
        <a href="#architecture">Architecture</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node Modules</a>
      </div>

      <div class="heading h2">
        <a href="#define-singleton-instance">Define singleton instance</a>
      </div>

      <div class="heading h2">
        <a href="#data-container">Data container</a>
      </div>

      <div class="heading h2">
        <a href="#setup-methods">Setup methods</a>
      </div>

      <div class="heading h3">
        <a href="#reload">Reload</a>
      </div>

      <div class="heading h2">
        <a href="#access-methods">Access methods</a>
      </div>

      <div class="heading h3">
        <a href="#initialize">Initialize</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-config" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="configuration">
  <h1>
    <a href="#configuration" name="configuration" class="pilcrow"></a>
Configuration
  </h1>
</div>
<p>This package will give you an easy way to load and use configuration settings
into your application or module.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="architecture">
  <h2>
    <a href="#architecture" name="architecture" class="pilcrow"></a>
Architecture
  </h2>
</div>
<p>The configuration handling consists of a singleton class as central information
storage like a registry. On access you will get references to the data.</p>
<p>A special behavior is the reloading of the configuration after the files
changed. This is done using a watcher on the file search path which will
automatically load all configurations which are changed into the class cache.
Through class events the instances will get informed if anything changed, so
they can reload their data and emit events for their application listeners
to update this data, too.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node Modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>include base modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'config'</span>)
debugValue = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'config:value'</span>)
debugAccess = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'config:access'</span>)
chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
util = <span class="hljs-built_in">require</span> <span class="hljs-string">'util'</span>
fspath = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>load other alinex modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">{string, object} = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-util'</span>
async = <span class="hljs-built_in">require</span> <span class="hljs-string">'alinex-async'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>load helper modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">load = <span class="hljs-built_in">require</span> <span class="hljs-string">'./load'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="define-singleton-instance">
  <h2>
    <a href="#define-singleton-instance" name="define-singleton-instance" class="pilcrow"></a>
Define singleton instance
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-built_in">module</span>.exports =

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="data-container">
  <h2>
    <a href="#data-container" name="data-container" class="pilcrow"></a>
Data container
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>configuration for loading</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">origin</span>: []
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>validation schema</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">schema</span>:
    <span class="hljs-attribute">type</span>: <span class="hljs-string">'object'</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>contents</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">value</span>: {}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>meta data for each data element</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">meta</span>: {}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>event listener for onChange event</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">listener</span>: {}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="setup-methods">
  <h2>
    <a href="#setup-methods" name="setup-methods" class="pilcrow"></a>
Setup methods
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
  <span class="hljs-attribute">pushOrigin</span>: <span class="hljs-function"><span class="hljs-params">(conf)</span> -&gt;</span> <span class="hljs-property">@origin</span>.push conf
  <span class="hljs-attribute">unshiftOrigin</span>: <span class="hljs-function"><span class="hljs-params">(conf)</span> -&gt;</span> <span class="hljs-property">@origin</span>.unshift conf

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>name - application name
basedir - path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">register</span>: <span class="hljs-function"><span class="hljs-params">(app, basedir, setup = {} )</span> -&gt;</span>
    uri = string.trim(setup.uri, <span class="hljs-string">'/'</span>) ? <span class="hljs-string">'*'</span>
    folder = setup.folder ? <span class="hljs-string">'config'</span>
    list = []
    <span class="hljs-keyword">if</span> basedir
      dir = fspath.resolve basedir
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>add src</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      list.push
        <span class="hljs-attribute">uri</span>: <span class="hljs-string">"<span class="hljs-subst">#{dir}</span>/var/src/<span class="hljs-subst">#{folder}</span>/<span class="hljs-subst">#{uri}</span>"</span>
        <span class="hljs-attribute">parser</span>: setup.parser
        <span class="hljs-attribute">path</span>: setup.path

        <span class="hljs-attribute">filter</span>: setup.filter
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>add local</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      list.push
        <span class="hljs-attribute">uri</span>: <span class="hljs-string">"<span class="hljs-subst">#{dir}</span>/var/local/<span class="hljs-subst">#{folder}</span>/<span class="hljs-subst">#{uri}</span>"</span>
        <span class="hljs-attribute">parser</span>: setup.parser
        <span class="hljs-attribute">path</span>: setup.path
        <span class="hljs-attribute">filter</span>: setup.filter
    <span class="hljs-keyword">if</span> app
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>add global</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      list.push
        <span class="hljs-attribute">uri</span>: <span class="hljs-string">"/etc/<span class="hljs-subst">#{app}</span>/<span class="hljs-subst">#{folder}</span>/<span class="hljs-subst">#{uri}</span>"</span>
        <span class="hljs-attribute">parser</span>: setup.parser
        <span class="hljs-attribute">path</span>: setup.path
        <span class="hljs-attribute">filter</span>: setup.filter
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>add user</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      dir = process.env.HOME ? process.env.USERPROFILE
      list.push
        <span class="hljs-attribute">uri</span>: <span class="hljs-string">"<span class="hljs-subst">#{dir}</span>/.<span class="hljs-subst">#{app}</span>/<span class="hljs-subst">#{folder}</span>/<span class="hljs-subst">#{uri}</span>"</span>
        <span class="hljs-attribute">parser</span>: setup.parser
        <span class="hljs-attribute">path</span>: setup.path
        <span class="hljs-attribute">filter</span>: setup.filter
    debug chalk.grey <span class="hljs-string">"register urls: <span class="hljs-subst">#{list.map (e) -&gt; e.uri}</span>"</span>
    <span class="hljs-property">@origin</span>.push list

  <span class="hljs-attribute">setSchema</span>: <span class="hljs-function"><span class="hljs-params">(path, schema, cb = -&gt; )</span> -&gt;</span>
    path = string.trim(path, <span class="hljs-string">'/'</span>).split <span class="hljs-string">'/'</span>
    ref = <span class="hljs-property">@schema</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>go into path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">if</span> path.length <span class="hljs-keyword">and</span> path[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> path
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>create structure if missing</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">        ref.type ?= <span class="hljs-string">'object'</span>
        ref.keys ?= {}
        ref.keys[p] ?= {}
        ref = ref.keys[p]
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>remove previous settings</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">delete</span> ref[k] <span class="hljs-keyword">for</span> k <span class="hljs-keyword">of</span> ref
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>set new schema</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    object.extend ref, schema
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>revalidate if already loaded</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">if</span> object.isEmpty <span class="hljs-property">@value</span>
    debug <span class="hljs-string">"revalidate against schema because <span class="hljs-subst">#{path ? <span class="hljs-string">'/'</span>}</span> changed"</span>
    load.validate <span class="hljs-keyword">this</span>, <span class="hljs-property">@value</span>, <span class="hljs-function"><span class="hljs-params">(err, value)</span> -&gt;</span>
      <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
      <span class="hljs-property">@value</span> = value

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="reload">
  <h3>
    <a href="#reload" name="reload" class="pilcrow"></a>
Reload
  </h3>
</div>
<p>This will re-import everything from scratch and if successful overwrite the
previous values.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-attribute">reload</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
    debug <span class="hljs-string">"reload configuration system"</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>step through origins and set as unloaded</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    origin.loaded = <span class="hljs-literal">false</span> <span class="hljs-keyword">for</span> origin <span class="hljs-keyword">in</span> load.listOrigins <span class="hljs-property">@origin</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>run init again</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    load.init <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-params">(err)</span> =&gt;</span>
      <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
      debugValue <span class="hljs-string">"new configuration \n<span class="hljs-subst">#{chalk.grey util.inspect <span class="hljs-property">@value</span>, {depth: <span class="hljs-literal">null</span>}</span>}"</span>
      cb()


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="access-methods">
  <h2>
    <a href="#access-methods" name="access-methods" class="pilcrow"></a>
Access methods
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">
  <span class="hljs-attribute">get</span>: <span class="hljs-function"><span class="hljs-params">(path)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> path <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
      path = string.trim(path, <span class="hljs-string">'/'</span>).split <span class="hljs-string">'/'</span>
      debugAccess <span class="hljs-string">"returning <span class="hljs-subst">#{path.join <span class="hljs-string">'/'</span>}</span>"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-property">@value</span> <span class="hljs-keyword">unless</span> path.length <span class="hljs-keyword">and</span> path[<span class="hljs-number">0</span>]
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>get sub path</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    ref = <span class="hljs-property">@value</span>
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> path
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">unless</span> ref[p]?
      ref = ref[p]
    debugAccess <span class="hljs-string">"not found <span class="hljs-subst">#{path.join <span class="hljs-string">'/'</span>}</span>"</span> <span class="hljs-keyword">unless</span> ref?
    <span class="hljs-keyword">return</span> ref

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="initialize">
  <h3>
    <a href="#initialize" name="initialize" class="pilcrow"></a>
Initialize
  </h3>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-built_in">module</span>.exports.init = async.onceTime <span class="hljs-built_in">module</span>.exports, <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
  debug <span class="hljs-string">"initialize configuration system"</span>
  needLoad = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">for</span> origin <span class="hljs-keyword">in</span> load.listOrigins <span class="hljs-property">@origin</span>
    <span class="hljs-keyword">if</span> origin.loaded
      debug chalk.grey <span class="hljs-string">"origin url: <span class="hljs-subst">#{origin.uri}</span> (already loaded)"</span>
      <span class="hljs-keyword">continue</span>
    debug chalk.grey <span class="hljs-string">"origin url: <span class="hljs-subst">#{origin.uri}</span>"</span>
    needLoad = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> cb() <span class="hljs-keyword">unless</span> needLoad
  load.init <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-params">(err)</span> =&gt;</span>
    <span class="hljs-keyword">return</span> cb err <span class="hljs-keyword">if</span> err
    debugValue <span class="hljs-string">"new configuration \n<span class="hljs-subst">#{chalk.grey util.inspect <span class="hljs-property">@value</span>, {depth: <span class="hljs-literal">null</span>}</span>}"</span>
    cb()

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
