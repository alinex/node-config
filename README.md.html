<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "home/alex/a3/node-config/README.md", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
  <script src="fileSearch.js"></script>
  <script src="goToLine.js"></script>
  <link rel="stylesheet" href="fileSearch.css" />
  <link rel="stylesheet" href="goToLine.css" />
</head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io" onmouseover="lllogo.src='http://alinex.github.io/images/Alinex-200.png'" onmouseout="lllogo.src='http://alinex.github.io/images/Alinex-black-200.png'">
  <img name="lllogo" src="http://alinex.github.io/images/Alinex-black-200.png" width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png" style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog.html" class="btn btn-primary"><span class="glyphicon-cog"></span> Blog</a>
  <a href="http://alinex.github.io/code.html" class="btn btn-warning"><span class="glyphicon-pencil"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#package%3A%20alinex-config">Package: alinex-config</a>
      </div>
      <div class="heading h2">
        <a href="#install">Install</a>
      </div>
      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>
      <div class="heading h2">
        <a href="#api">API</a>
      </div>
      <div class="heading h3">
        <a href="#class%20configuration">Class configuration</a>
      </div>
      <div class="heading h3">
        <a href="#static%20calls">Static calls</a>
      </div>
      <div class="heading h3">
        <a href="#instances">Instances</a>
      </div>
      <div class="heading h3">
        <a href="#instance%20events">Instance Events</a>
      </div>
      <div class="heading h2">
        <a href="#search%20and%20order">Search and order</a>
      </div>
      <div class="heading h2">
        <a href="#overloading">Overloading</a>
      </div>
      <div class="heading h2">
        <a href="#file%20formats">File Formats</a>
      </div>
      <div class="heading h3">
        <a href="#yaml">YAML</a>
      </div>
      <div class="heading h3">
        <a href="#json">JSON</a>
      </div>
      <div class="heading h3">
        <a href="#xml">XML</a>
      </div>
      <div class="heading h3">
        <a href="#javascript">JavaScript</a>
      </div>
      <div class="heading h3">
        <a href="#coffeescript">CoffeeScript</a>
      </div>
      <div class="heading h3">
        <a href="#ini%20file">Ini file</a>
      </div>
      <div class="heading h3">
        <a href="#rdbms">RDBMS</a>
      </div>
      <div class="heading h3">
        <a href="#object%20db">Object DB</a>
      </div>
      <div class="heading h2">
        <a href="#default%20values">Default values</a>
      </div>
      <div class="heading h2">
        <a href="#validation%20and%20optimization">Validation and Optimization</a>
      </div>
      <div class="heading h3">
        <a href="#validator%20structure">Validator structure</a>
      </div>
      <div class="heading h3">
        <a href="#check%20function">Check function</a>
      </div>
      <div class="heading h3">
        <a href="#predefined%20checks">Predefined checks</a>
      </div>
      <div class="heading h3">
        <a href="#using%20alinex-validator">Using alinex-validator</a>
      </div>
      <div class="heading h2">
        <a href="#working%20with%20events">Working with events</a>
      </div>
      <div class="heading h2">
        <a href="#watching%20for%20changes">Watching for changes</a>
      </div>
      <div class="heading h2">
        <a href="#examples">Examples</a>
      </div>
      <div class="heading h3">
        <a href="#use%20in%20class%20for%20single%20init">Use in class for single init</a>
      </div>
      <div class="heading h2">
        <a href="#submodule%20pattern">Submodule pattern</a>
      </div>
      <div class="heading h3">
        <a href="#submodule">Submodule</a>
      </div>
      <div class="heading h3">
        <a href="#parent%20module">Parent module</a>
      </div>
      <div class="heading h2">
        <a href="#license">License</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-config" title="Fork me on GitHub"></a><div class="docs markdown">
<div class="pilwrap" id="package%3A%20alinex-config">
  <h1>
    <a href="#package%3A%20alinex-config" name="package%3A%20alinex-config" class="pilcrow">&#182;</a>
    Package: alinex-config
  </h1>
</div>


<p><a href="https://travis-ci.org/alinex/node-config"><img src="https://travis-ci.org/alinex/node-config.svg?branch=master" alt="Build Status" title="" /></a>
<a href="https://gemnasium.com/alinex/node-config"><img src="https://gemnasium.com/alinex/node-config.png" alt="Dependency Status" title="" /></a></p>

<p>This package will give you an easy way to load and use configuration settings in
your application or module.</p>

<p>It will read named files in different formats (YAML, JSON, XML, JavaScript,
CoffeeScript) and supports validation and optimization/completion. Also the
configuration will automatically be updated on changes in the file system
and may inform it's dependent objects.</p>

<p>The major features are:</p>

<ul>
<li>over writable configurations</li>
<li>allows different file formats</li>
<li>supports value validation</li>
<li>supports value modification rules</li>
<li>automatically reloads on file changes</li>
</ul>

<p>It is one of the modules of the <a href="http://alinex.github.io/node-alinex">Alinex Universe</a>
following the code standards defined there.</p>


<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow">&#182;</a>
    Install
  </h2>
</div>


<p>The easiest way is to let npm add the module directly:</p>


<div class="highlight"><pre><code>npm install alinex-config --save
</code></pre></div>



<p><a href="https://nodei.co/npm/alinex-config/"><img src="https://nodei.co/npm/alinex-config.png?downloads=true&amp;stars=true" alt="NPM" title="" /></a></p>


<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow">&#182;</a>
    Usage
  </h2>
</div>


<p>To easily make your module configurable you need to load the class first:</p>


<div class="highlight"><pre><code><span class="nv">Config = </span><span class="nx">require</span> <span class="s">&#39;alinex-config&#39;</span>
</code></pre></div>



<p>To load a specific configuration you have to instantiate it with it's name. The
factory method will help to only have one instance per each configuration name.</p>


<div class="highlight"><pre><code><span class="nv">config = </span><span class="nx">Config</span><span class="p">.</span><span class="nx">instance</span> <span class="s">&#39;server&#39;</span>
</code></pre></div>



<p>Before using it you now have to load the configuration. That will be started
after calling <code>load</code>. After that you got the settings as properties for easy
access.</p>


<div class="highlight"><pre><code><span class="nx">config</span><span class="p">.</span><span class="nx">load</span> <span class="nf">(err, data) -&gt;</span>
  <span class="k">if</span> <span class="nx">err</span>
    <span class="c1"># report error and stop</span>
  <span class="c1"># work with configuration values</span>
  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&#39;Started at &#39;</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span>
</code></pre></div>



<p>To make accessing of the config values shorter you may also use:</p>


<div class="highlight"><pre><code><span class="nx">Config</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="nx">search</span><span class="p">,</span> <span class="nx">check</span><span class="p">,</span> <span class="nf">(err, config) -&gt;</span>
  <span class="c1"># now you may use the values</span>
</code></pre></div>



<p>This allows you to optionally set search order and validation checks.</p>


<div class="pilwrap" id="api">
  <h2>
    <a href="#api" name="api" class="pilcrow">&#182;</a>
    API
  </h2>
</div>



<div class="pilwrap" id="class%20configuration">
  <h3>
    <a href="#class%20configuration" name="class%20configuration" class="pilcrow">&#182;</a>
    Class configuration
  </h3>
</div>


<ul>
<li><a href="src/index.coffee.html#search">Config.search</a> - to set the search path</li>
<li><code>Config.watch</code> - (boolean) set to true to enable reloading globally</li>
</ul>


<div class="pilwrap" id="static%20calls">
  <h3>
    <a href="#static%20calls" name="static%20calls" class="pilcrow">&#182;</a>
    Static calls
  </h3>
</div>


<ul>
<li><a href="src/index.coffee.html#find configuration files">Config.find()</a> - to search for
existing configuration files</li>
<li><a href="src/index.coffee.html#factory">Config.instance()</a> - to get a config instance</li>
<li>Config.get() - as easy access method</li>
</ul>


<div class="pilwrap" id="instances">
  <h3>
    <a href="#instances" name="instances" class="pilcrow">&#182;</a>
    Instances
  </h3>
</div>


<ul>
<li><a href="src/index.coffee.html#create instance">new Config()</a> - to create a new config
instance</li>
<li>config.search - to set the search path</li>
<li><a href="src/index.coffee.html#default values">config.default</a> - to set the default values
(this can also be done through the check)</li>
<li><a href="src/index.coffee.html#set check">config.setCheck()</a> - to validate or
optimize the values</li>
<li>config.load() - loading the configuration</li>
<li>config.reload() - loading the configuration</li>
<li>config.watching(<bool>) - start or stop the watching of config changes</li>
<li>config.data - values are directly accessible</li>
<li>config.getData() - get data from config instance, name or config object</li>
</ul>


<div class="pilwrap" id="instance%20events">
  <h3>
    <a href="#instance%20events" name="instance%20events" class="pilcrow">&#182;</a>
    Instance Events
  </h3>
</div>


<p>The following events are supported:</p>

<ul>
<li><code>error</code> - then something fails (with message as data)</li>
<li><code>change</code> - the instance data has changed after loading</li>
</ul>


<div class="pilwrap" id="search%20and%20order">
  <h2>
    <a href="#search%20and%20order" name="search%20and%20order" class="pilcrow">&#182;</a>
    Search and order
  </h2>
</div>


<p>Configurations are searched in all supported file formats under the given
directories and below.</p>

<p>The files are searched in the following order of directories:</p>

<ul>
<li><code>var/src/config</code></li>
<li><code>var/local/config</code></li>
<li><code>~/.&lt;process&gt;/config</code></li>
<li><code>/etc/&lt;process&gt;/config</code></li>
</ul>

<p>And within these the files are searched with the given name in different formats
(maybe also with mixed formats):</p>

<ul>
<li><code>&lt;name&gt;.yml</code></li>
<li><code>&lt;name&gt;-part1.yml</code></li>
<li><code>&lt;name&gt;-part2.yml</code></li>
</ul>

<p>The order is essential because the later file will overwrite the same keys of
the earlier ones. So the order looks like:</p>

<ol>
<li>Use each directory in given search list order</li>
<li>Use files with only base names</li>
<li>Use the partial extensions in alphabetical order</li>
</ol>

<p>To configure where to look for files you may give a list of directories:</p>


<div class="highlight"><pre><code><span class="nv">Config.search = </span><span class="p">[</span><span class="s">&#39;var/src/config&#39;</span><span class="p">,</span> <span class="s">&#39;var/local/config&#39;</span><span class="p">]</span>
</code></pre></div>



<p>This will set the search paths for all new instances but you may also define
the search paths on a single instance.</p>


<div class="pilwrap" id="overloading">
  <h2>
    <a href="#overloading" name="overloading" class="pilcrow">&#182;</a>
    Overloading
  </h2>
</div>


<p>If multiple directories given and/or multiple files (maybe in different formats)
were found they will overload each other.</p>

<p>This means if a value is set in two or more files the last will overwrite the
one before. But it will also combine the contents if different keys in an object
are used.</p>

<p>The files overload in the following order:</p>

<ol>
<li>files alphabetically in directory</li>
<li>directories as specified in search path</li>
</ol>


<div class="pilwrap" id="file%20formats">
  <h2>
    <a href="#file%20formats" name="file%20formats" class="pilcrow">&#182;</a>
    File Formats
  </h2>
</div>


<p>This configuration class allows multiple formats to be used alternatively or combined.
So you may use the format you know best. The following table will give a short
comparison.</p>

<p style="font-family:monospace;white-space:pre">|   Format    | YAML | JSON | XML |  JS | Coffee | INI | RDBMS | ObjDB |
|:------------|-----:|-----:|----:|----:|-------:|----:|------:|------:|
| Supported   |  yes |  yes | yes | yes |    yes |  no |    no |    no |
| Comments    |  yes | (yes)| yes | yes |    yes | yes |   yes | (yes) |
| Structure   |  yes |  yes | yes | yes |    yes |  no |   yes |   yes |
| Reloadable  |  yes |  yes | yes | yes |    yes | yes | (yes) | (yes) |
| Readiness   |  +++ |   ++ |   - |  ++ |    +++ |   + |     + |    ++ |
| Performance |   ++ |  +++ |   + | +++ |     ++ |  ++ |     - |     + |
| Common      |    + |   ++ | +++ |  -- |    --- |   + |     - |    -- |</p>


<div class="pilwrap" id="yaml">
  <h3>
    <a href="#yaml" name="yaml" class="pilcrow">&#182;</a>
    YAML
  </h3>
</div>


<p>This is a simplified and best human readable language to write structured
information. See some examples at <a href="http://en.wikipedia.org/wiki/YAML">Wikipedia</a>.</p>

<p>Use the file extensions <code>yml</code> or <code>yaml</code>.</p>

<p><strong>Example</strong></p>

<p>title: YAML Test</p>


<div class="highlight"><pre><code><span class="c1"># use an object</span>
<span class="l-Scalar-Plain">yaml</span><span class="p-Indicator">:</span>
  <span class="c1"># include text elements</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">test</span>
  <span class="l-Scalar-Plain">name2</span><span class="p-Indicator">:</span> <span class="s">&#39;commas</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">quotes,</span><span class="nv"> </span><span class="s">too&#39;</span>
  <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="p-Indicator">&gt;</span>
    <span class="no">This may be a very long</span>
    <span class="no">line in which newlines</span>
    <span class="no">will be removed.</span>
  <span class="c1"># and some lists</span>
  <span class="l-Scalar-Plain">list</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1, 2, 3</span>
  <span class="l-Scalar-Plain">list2</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">red</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">green</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">blue</span>
</code></pre></div>




<div class="pilwrap" id="json">
  <h3>
    <a href="#json" name="json" class="pilcrow">&#182;</a>
    JSON
  </h3>
</div>


<p>This format uses the javascript object notation a human readable structure. It
is widely used in different languages not only JavaScript. See description at
<a href="http://en.wikipedia.org/wiki/Json">Wikipedia</a>.</p>

<p>JSON won't allow comments but you may use JavaScript like comments using
<code>//</code> and <code>/*...*/</code> like known in javascript. They will be removed before
interpreting the file contents.</p>

<p>Use the file extension <code>json</code>.</p>


<div class="highlight"><pre><code><span class="p">{</span>
  <span class="err">//</span> <span class="err">use</span> <span class="err">an</span> <span class="err">object</span>
  <span class="nt">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="err">//</span> <span class="err">include</span> <span class="err">text</span> <span class="err">elements</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="err">//</span> <span class="err">and</span> <span class="err">a</span> <span class="err">list</span> <span class="err">of</span> <span class="err">numbers</span>
    <span class="nt">&quot;list&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<div class="pilwrap" id="xml">
  <h3>
    <a href="#xml" name="xml" class="pilcrow">&#182;</a>
    XML
  </h3>
</div>


<p>The XML format should only use Tags and values, but no arguments.</p>

<p>Use the file extension <code>xml</code>.</p>


<div class="highlight"><pre><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="c">&lt;!-- use an object --&gt;</span>
<span class="nt">&lt;xml&gt;</span>
  <span class="c">&lt;!-- include a string --&gt;</span>
  <span class="nt">&lt;name&gt;</span>test<span class="nt">&lt;/name&gt;</span>
  <span class="c">&lt;!-- and a list of numbers --&gt;</span>
  <span class="nt">&lt;list&gt;</span>1<span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;list&gt;</span>2<span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;list&gt;</span>3<span class="nt">&lt;/list&gt;</span>
<span class="nt">&lt;/xml&gt;</span>
</code></pre></div>




<div class="pilwrap" id="javascript">
  <h3>
    <a href="#javascript" name="javascript" class="pilcrow">&#182;</a>
    JavaScript
  </h3>
</div>


<p>Also allowed are normal JavaScript modules like done in node.js. The module must
export the configuration object.</p>

<p>Use the file extension <code>js</code>.</p>


<div class="highlight"><pre><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// use an object</span>
  <span class="nx">javascript</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// include a string</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="c1">// and a list of numbers</span>
    <span class="nx">list</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>




<div class="pilwrap" id="coffeescript">
  <h3>
    <a href="#coffeescript" name="coffeescript" class="pilcrow">&#182;</a>
    CoffeeScript
  </h3>
</div>


<p>Like above you may write the modules in CoffeeScript.</p>

<p>Use the file extension <code>coffee</code>.</p>


<div class="highlight"><pre><code><span class="nv">module.exports =</span>
  <span class="c1"># use an object</span>
  <span class="nv">coffee:</span>
    <span class="c1"># include a string</span>
    <span class="nv">name: </span><span class="s">&quot;test&quot;</span>
    <span class="c1"># and a list of numbers</span>
    <span class="nv">list: </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div>




<div class="pilwrap" id="ini%20file">
  <h3>
    <a href="#ini%20file" name="ini%20file" class="pilcrow">&#182;</a>
    Ini file
  </h3>
</div>


<p>Not supported, yet.</p>


<div class="highlight"><pre><code><span class="c1">; use an object</span>
<span class="c1">; include a string</span>
<span class="na">name</span> <span class="o">=</span> <span class="s">test</span>
<span class="c1">; and a list of numbers</span>
<span class="na">list[]</span> <span class="o">=</span> <span class="s">1</span>
<span class="na">list[]</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">list[]</span> <span class="o">=</span> <span class="s">3</span>
<span class="c1">; and use groups</span>
<span class="k">[group1]</span>
<span class="na">name</span> <span class="o">=</span> <span class="s">group1</span>
<span class="c1">; and also subgroups</span>
<span class="k">[group1.sub]</span>
<span class="na">name</span> <span class="o">=</span> <span class="s">subgroup1</span>
</code></pre></div>




<div class="pilwrap" id="rdbms">
  <h3>
    <a href="#rdbms" name="rdbms" class="pilcrow">&#182;</a>
    RDBMS
  </h3>
</div>


<p>Not supported, yet.</p>

<p style="font-family:monospace;white-space:pre">| lastchange       | group | key          |  value | comment |
|------------------|-------|:-------------|:-------|:--------|
| 2014-12-11 19:45 | test  | rdbms        | null   | use an object |
| 2014-12-11 19:45 | test  | rdbms.name   | "name" | include a string |
| 2014-12-11 19:45 | test  | rdbms.list   | null   | and a list of numbers |
| 2014-12-11 19:45 | test  | rdbms.list[] | 1      |  |
| 2014-12-11 19:45 | test  | rdbms.list[] | 2      |  |
| 2014-12-11 19:45 | test  | rdbms.list[] | 3      |  |</p>


<div class="pilwrap" id="object%20db">
  <h3>
    <a href="#object%20db" name="object%20db" class="pilcrow">&#182;</a>
    Object DB
  </h3>
</div>


<p>Not supported, yet.</p>

<p>Here, the JSON will be stored in the database like in the JSON file.</p>


<div class="pilwrap" id="default%20values">
  <h2>
    <a href="#default%20values" name="default%20values" class="pilcrow">&#182;</a>
    Default values
  </h2>
</div>


<p>It is possible to set default values for each configuration on the class.</p>


<div class="highlight"><pre><code><span class="nv">Config.default = </span><span class="p">{</span> <span class="nv">server: </span><span class="p">{</span> <span class="nv">url: </span><span class="s">&#39;http://localhost&#39;</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div>



<p>This will be set if not overwritten in any configuration file for the <code>server</code>
configuration.</p>


<div class="pilwrap" id="validation%20and%20optimization">
  <h2>
    <a href="#validation%20and%20optimization" name="validation%20and%20optimization" class="pilcrow">&#182;</a>
    Validation and Optimization
  </h2>
</div>


<p>You may use synchronous functions, but asynchronous will be more widely
supported.
If asynchronous check-functions are given it is possible to validate and
manipulate the loaded configuration values, before they are used. You may also
add such check functions after you created the first instances. (But the newly
added toplevel config entries are not updated.)</p>

<p>You have two possibilities to declare checks. You may use an
<a href="http://alinex.github.io/node-validator">alinex-validator</a> compatible structure
or use you own function.</p>


<div class="pilwrap" id="validator%20structure">
  <h3>
    <a href="#validator%20structure" name="validator%20structure" class="pilcrow">&#182;</a>
    Validator structure
  </h3>
</div>


<p>This is best used if now special methods like internal reference checks...
have to be done.</p>


<div class="highlight"><pre><code><span class="nx">Config</span><span class="p">.</span><span class="nx">addCheck</span> <span class="s">&#39;server&#39;</span><span class="p">,</span>
  <span class="nv">title: </span><span class="s">&quot;Testfile&quot;</span>
  <span class="nv">description: </span><span class="s">&#39;the structure used to demonstrate here&#39;</span>
  <span class="nv">check: </span><span class="s">&#39;type.string&#39;</span>
  <span class="nv">maxLength: </span><span class="mi">25</span>
<span class="p">,</span> <span class="nf">(err) -&gt;</span>
  <span class="c1"># may get an error if values already loaded</span>
</code></pre></div>




<div class="pilwrap" id="check%20function">
  <h3>
    <a href="#check%20function" name="check%20function" class="pilcrow">&#182;</a>
    Check function
  </h3>
</div>


<p>With the check function you may define what you want, but you also can combine
it with the validator.</p>


<div class="highlight"><pre><code><span class="nv">myCheck = </span><span class="nf">(name, values, cb) -&gt;</span>
  <span class="c1"># change or check the values</span>
  <span class="c1"># ...</span>
  <span class="c1"># on error call cb(&#39;something is not ok&#39;);</span>
  <span class="nx">cb</span><span class="p">()</span>

<span class="nx">Config</span><span class="p">.</span><span class="nx">addCheck</span> <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="nx">myCheck</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
  <span class="c1"># may get an error if values already loaded</span>
</code></pre></div>



<p>The <code>name</code> here is the name of the configuration which may be used in reporting.
The <code>values</code> maybe changed.</p>

<p>If an error is returned it will also be returned while adding the check or within
the constructor. But it won't stop the processing. You may also throw an error
to really stop if a check failed.</p>

<p>This checks have to be added to the Config class using <code>Config.addCheck(name, check):</code></p>


<div class="pilwrap" id="predefined%20checks">
  <h3>
    <a href="#predefined%20checks" name="predefined%20checks" class="pilcrow">&#182;</a>
    Predefined checks
  </h3>
</div>


<p>Classes or functions which support this module often has predefined checks
to be used.</p>


<div class="highlight"><pre><code><span class="nx">Config</span><span class="p">.</span><span class="nx">addCheck</span> <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="nx">AnyClass</span><span class="p">.</span><span class="nx">check</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
  <span class="c1"># may get an error if values already loaded</span>
</code></pre></div>



<p>But if the configuration for AnyClass is only a subgroup of a bigger configuration
file you have to wrap the call in an additional function:</p>


<div class="highlight"><pre><code><span class="c1"># the wrapper function</span>
<span class="nv">myCheck = </span><span class="nf">(name, values, cb) -&gt;</span>
  <span class="c1"># change the name to reflect change in reporting</span>
  <span class="c1"># call it with the subgroup</span>
  <span class="nx">AnyClass</span><span class="p">.</span><span class="nx">check</span> <span class="nx">name</span><span class="o">+</span><span class="s">&#39;.anygroup&#39;</span><span class="p">,</span> <span class="nx">values</span><span class="p">.</span><span class="nx">anygroup</span><span class="p">,</span> <span class="nx">cb</span>

<span class="nx">Config</span><span class="p">.</span><span class="nx">addCheck</span> <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="nx">myCheck</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
  <span class="c1"># may get an error if values already loaded</span>
</code></pre></div>




<div class="pilwrap" id="using%20alinex-validator">
  <h3>
    <a href="#using%20alinex-validator" name="using%20alinex-validator" class="pilcrow">&#182;</a>
    Using alinex-validator
  </h3>
</div>


<p>A very easy way to do validations is through the
<a href="alinex-validator">https://alinex.github.io/node-validator</a> module. It let's
you define your validation rules as rule structure in an object.</p>


<div class="highlight"><pre><code><span class="nx">Config</span><span class="p">.</span><span class="nx">addCheck</span> <span class="nf">(name, values, cb) -&gt;</span>
  <span class="k">return</span> <span class="nx">validator</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nf">-&gt;</span>
    <span class="nv">type: </span><span class="s">&#39;type.integer&#39;</span>
    <span class="nv">options:</span>
      <span class="nv">min: </span><span class="mi">0</span><span class="p">,</span>
      <span class="nv">max: </span><span class="mi">100</span>
  <span class="p">,</span> <span class="nx">cb</span>
</code></pre></div>



<p>That's the way most alinex modules implement their own check methods.</p>


<div class="pilwrap" id="working%20with%20events">
  <h2>
    <a href="#working%20with%20events" name="working%20with%20events" class="pilcrow">&#182;</a>
    Working with events
  </h2>
</div>


<p>While the configuration may change you should listen to the <code>change</code> event which
will inform for any change in the current configuration. Now you have to reinit
everything which changed.</p>

<p>Keep in mind to alway unregister event listeners while no longer used to prevent
memory leaks.</p>

<p>An example might look like:</p>


<div class="highlight"><pre><code><span class="c1"># create two listener methods</span>
<span class="nv">sendError = </span><span class="nf">(err) -&gt;</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">removeListener</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">sendChange</span>
  <span class="c1"># do something....</span>
<span class="nv">sendChange = </span><span class="nf">-&gt;</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">removeListener</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">sendError</span>
  <span class="c1"># do something....</span>

<span class="c1"># start listening</span>
<span class="nx">config</span><span class="p">.</span><span class="nx">once</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">sendError</span>
<span class="nx">config</span><span class="p">.</span><span class="nx">once</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">sendChange</span>
</code></pre></div>




<div class="pilwrap" id="watching%20for%20changes">
  <h2>
    <a href="#watching%20for%20changes" name="watching%20for%20changes" class="pilcrow">&#182;</a>
    Watching for changes
  </h2>
</div>


<p>It is possible to watch for file changes and automatically reload the configuration
if something changes.</p>

<p>If any file in the configuration directory changes it will reload the data
and send an <code>change</code> event after validating.</p>

<p>This feature is disabled by default but may be enabled globally using</p>


<div class="highlight"><pre><code><span class="nv">Config.watch = </span><span class="kc">true</span>
</code></pre></div>



<p>But do this before using the Config class!</p>

<p>You may also enable and disable this feature on each instance by calling</p>


<div class="highlight"><pre><code><span class="nx">config</span><span class="p">.</span><span class="nx">watching</span> <span class="nx">boolean</span>
</code></pre></div>




<div class="pilwrap" id="examples">
  <h2>
    <a href="#examples" name="examples" class="pilcrow">&#182;</a>
    Examples
  </h2>
</div>



<div class="pilwrap" id="use%20in%20class%20for%20single%20init">
  <h3>
    <a href="#use%20in%20class%20for%20single%20init" name="use%20in%20class%20for%20single%20init" class="pilcrow">&#182;</a>
    Use in class for single init
  </h3>
</div>



<div class="highlight"><pre><code><span class="nv">Config = </span><span class="nx">require</span> <span class="s">&#39;alinex-config&#39;</span>
<span class="nv">configcheck = </span><span class="nx">require</span> <span class="s">&#39;./configcheck&#39;</span>

<span class="k">class</span> <span class="nx">Spawn</span>
  <span class="vi">@init: </span><span class="nf">(config = &#39;spawn&#39;, cb) -&gt;</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@config</span> <span class="c1"># already loaded</span>
    <span class="nx">@_configSource</span> <span class="o">?=</span> <span class="nx">config</span> <span class="c1"># store what to load</span>
    <span class="c1"># start resolving configuration</span>
    <span class="nx">Config</span><span class="p">.</span><span class="nx">get</span> <span class="nx">@_configSource</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s">&#39;var/src/config&#39;</span>
      <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">),</span> <span class="s">&#39;var/local/config&#39;</span>
    <span class="p">],</span> <span class="nx">configcheck</span><span class="p">,</span> <span class="nf">(err, @config) -&gt;</span>
      <span class="c1"># results stored, now check for errors</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">cb</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">cb</span><span class="o">?</span>

  <span class="nv">constructor: </span><span class="nf">-&gt;</span>
    <span class="c1"># do something</span>

  <span class="nv">run: </span><span class="nf">(cb) -&gt;</span>
    <span class="nx">@constructor</span><span class="p">.</span><span class="nx">init</span> <span class="kc">null</span><span class="p">,</span> <span class="nf">(err) -&gt;</span>
</code></pre></div>



<p>Now you should use this class like:</p>


<div class="highlight"><pre><code><span class="nx">Spawn</span><span class="p">.</span><span class="nx">init</span> <span class="s">&#39;spawn&#39;</span>
<span class="nv">xxx = </span><span class="k">new</span> <span class="nx">Spawn</span><span class="p">()</span>
<span class="nx">xxx</span><span class="p">.</span><span class="nx">run</span><span class="p">()</span>
<span class="c1"># or use the default config name</span>
<span class="nv">xxx = </span><span class="k">new</span> <span class="nx">Spawn</span><span class="p">()</span>
<span class="nx">xxx</span><span class="p">.</span><span class="nx">run</span><span class="p">()</span>
</code></pre></div>




<div class="pilwrap" id="submodule%20pattern">
  <h2>
    <a href="#submodule%20pattern" name="submodule%20pattern" class="pilcrow">&#182;</a>
    Submodule pattern
  </h2>
</div>


<p>To make configuration work through a complex system of program, modules and
submodules the following pattern may help. (For better overview the example is
written in coffee script)</p>


<div class="pilwrap" id="submodule">
  <h3>
    <a href="#submodule" name="submodule" class="pilcrow">&#182;</a>
    Submodule
  </h3>
</div>


<p>In the module you load the configuration class and make an init method which is used
to start loading the configuration.</p>


<div class="highlight"><pre><code><span class="nv">Config = </span><span class="nx">require</span> <span class="s">&#39;alinex-config&#39;</span>

<span class="k">class</span> <span class="nx">Test</span>

  <span class="vi">@init: </span><span class="nf">(@config = &#39;spawn&#39;, cb) -&gt;</span>
    <span class="nx">debug</span> <span class="s">&quot;init or reinit spawn&quot;</span>
    <span class="c1"># set config from different values</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">@config</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
      <span class="vi">@config = </span><span class="nx">Config</span><span class="p">.</span><span class="nx">instance</span> <span class="nx">@config</span>
      <span class="c1"># add the module&#39;s directory the default</span>
      <span class="nx">@config</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">unshift</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span> <span class="nx">__dirname</span><span class="p">,</span> <span class="s">&#39;var/src/config&#39;</span>
      <span class="c1"># add the check methods</span>
      <span class="nx">@config</span><span class="p">.</span><span class="nx">setCheck</span> <span class="nx">configcheck</span>
    <span class="k">if</span> <span class="nx">@config</span> <span class="k">instanceof</span> <span class="nx">Config</span>
      <span class="vi">@configClass = </span><span class="nx">@config</span>
      <span class="vi">@config = </span><span class="nx">@configClass</span><span class="p">.</span><span class="nx">data</span>
    <span class="vi">@initDone = </span><span class="kc">false</span> <span class="c1"># status set to true after initializing</span>
    <span class="c1"># set init status if configuration is loaded</span>
    <span class="k">unless</span> <span class="nx">@configClass</span><span class="o">?</span>
      <span class="nx">cb</span><span class="p">()</span> <span class="k">if</span> <span class="nx">cb</span><span class="o">?</span>
      <span class="vi">@initDone = </span><span class="kc">true</span>
    <span class="k">else</span>
      <span class="c1"># wait till configuration is loaded</span>
      <span class="nx">@configClass</span><span class="p">.</span><span class="nx">load</span> <span class="nf">(err) =&gt;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">cb</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">cb</span><span class="o">?</span>
        <span class="vi">@initDone = </span><span class="kc">true</span>
</code></pre></div>



<p>This method can consume different informations:</p>

<ul>
<li>a string specifying the configuration file</li>
<li>a already configured <code>Config</code> instance</li>
<li>an object holding all the configuration values</li>
</ul>

<p>And when the configuration is needed in example in an run method:</p>


<div class="highlight"><pre><code><span class="nv">run: </span><span class="nf">(cb) -&gt;</span>
  <span class="c1"># start initializing, if not done</span>
  <span class="k">unless</span> <span class="nx">Spawn</span><span class="p">.</span><span class="nx">initDone</span><span class="o">?</span>
    <span class="k">return</span> <span class="nx">Spawn</span><span class="p">.</span><span class="nx">init</span> <span class="kc">null</span><span class="p">,</span> <span class="o">=&gt;</span> <span class="nx">@run</span> <span class="nx">cb</span>
  <span class="c1"># wait till configuration is loaded</span>
  <span class="k">if</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">configClass</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">configClass</span><span class="p">.</span><span class="nx">loaded</span>
    <span class="k">return</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">configClass</span><span class="p">.</span><span class="nx">load</span> <span class="nf">(err) =&gt;</span>
      <span class="k">return</span> <span class="nx">cb</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">@run</span> <span class="nx">cb</span>
</code></pre></div>



<p>This will check the configuration and call the load method. If loading is already
in progress the new call will be attached to the event and get also notified if
it is loaded.</p>


<div class="pilwrap" id="parent%20module">
  <h3>
    <a href="#parent%20module" name="parent%20module" class="pilcrow">&#182;</a>
    Parent module
  </h3>
</div>


<p>Now you may use this in the parent module or program:</p>


<div class="highlight"><pre><code><span class="nv">run = </span><span class="nf">(cb) -&gt;</span>
  <span class="c1"># start initializing, if not done</span>
  <span class="k">unless</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">initDone</span><span class="o">?</span>
    <span class="k">return</span> <span class="nx">Test</span><span class="p">.</span><span class="nx">init</span> <span class="kc">null</span><span class="p">,</span> <span class="o">=&gt;</span> <span class="nx">@run</span> <span class="nx">cb</span>
  <span class="c1"># code running if initialized</span>
  <span class="c1"># ...</span>
</code></pre></div>




<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow">&#182;</a>
    License
  </h2>
</div>


<p>Copyright 2014-2015 Alexander Schilling</p>

<p>Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>

<blockquote>
  <p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</blockquote>

<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p></div>
  </div>
</body>
</html>
